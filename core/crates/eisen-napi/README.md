# eisen-napi

NAPI-RS bridge exposing `eisen-core`'s parser to TypeScript/Bun via a `.node` native addon.

Replaces the PyO3 bridge (`pybridge/`). Loads in-process via Node-API — no spawning, no JSON-over-stdio boundary.

## Exported Functions

| Function | Input | Output |
|---|---|---|
| `parseWorkspace(path)` | Workspace directory path | Nested `SerializableNode` tree (JSON) |
| `parseFile(path)` | File path | Array of `NodeData` (JSON) |
| `snapshot(path)` | Workspace directory path | `UiSnapshot` (JSON) |
| `lookupSymbol(workspace, name)` | Workspace path + symbol name | Array of `NodeData` (JSON) |

All functions return JSON strings. The TypeScript wrapper at `extension/src/napi/eisen.ts` parses these into typed objects.

## Development

```bash
# Install JS dependencies
bun install

# Build debug
bunx napi build --platform

# Build release
bunx napi build --platform --release

# Run tests
bun test __tests__/napi.test.ts
```

## Build Output

After building, three files are generated:

- `eisen-napi.<platform>.node` — native binary
- `index.js` — cross-platform loader (auto-generated by napi-rs)
- `index.d.ts` — TypeScript declarations (auto-generated by napi-rs)

## CI

The `.github/workflows/napi.yml` workflow builds for:

- `x86_64-unknown-linux-gnu`
- `aarch64-apple-darwin`
- `x86_64-apple-darwin`
- `x86_64-pc-windows-msvc`

The main `ci.yml` release workflow bundles the `.node` binary into the VSIX at `extension/napi/`.
